<%
	let objOrdre = {
		"_id":"asc",
		"nom":"asc",
		"prenom":"asc",
		"telephone":"asc",
		"courriel":"asc"
	}
	if(typeof cle!=="undefined" && cle) {
		objOrdre[cle] = ordre
	}
%>

<button id='testAJAX'>test AJAX</button>
<table class="tableau">
 <tr>
 <th><a href='/trier/id/<%=objOrdre._id%>'>ID</a></th>
 <th><a href='/trier/nom/<%=objOrdre.nom%>'><%= __('Nom') %></a></th> 
 <th><a href='/trier/prenom/<%=objOrdre.prenom%>'><%= __('Prénom') %></a></th>
 <th><a href='/trier/telephone/<%=objOrdre.telephone%>'><%= __('Téléphone') %></a></th>
 <th><a href='/trier/courriel/<%=objOrdre.courriel%>'><%= __('Courriel') %></a></th>
 <th><i class="far fa-trash-alt"></i></th> 
 </tr>
 <% adresses.forEach(elm => {%>
 <tr>
 <td><%= elm._id %></td>
 <td contenteditable='true'><%= elm.nom %></td>
 <td contenteditable='true'><%= elm.prenom %></td>
 <td contenteditable='true'><%= elm.telephone %></td>
 <td contenteditable='true'><%= elm.courriel %></td>
 <td><a href="/delete/<%= elm._id %>"><i class="far fa-trash-alt"></i></a></td>
 <td><a class='sauver' href="#"><i class="fas fa-save"></i></a></td>
 </tr>
 <% }) %>
 </table>

 <script>
 	// Notre code JavaScript pour effectuer un transfert AJAX
	let elmBouton = document.getElementById('testAJAX')
	elmBouton.addEventListener('click', ()=>{
		console.log('ok')
		xhr = new XMLHttpRequest();
		xhr.open('POST', "modifier", true);
		data = { 
			"nom" : elmLigneDiv[0].innerHTML,
			"prenom" : elmLigneDiv[1].innerHTML,
			"telephone" : elmLigneDiv[2].innerHTML,
			"_id" : elmLigneDiv[3].innerHTML 
		}
		sData = JSON.stringify(data);
		xhr.setRequestHeader('Content-type', 'application/json');
		xhr.send(sData);
		xhr.addEventListener("readystatechange", traiterRequest, false);
	})

	// Pour traiter le résultat transmis par l'application serveur 
	function traiterRequest(e) {
		console.log("xhr.readyState = " + xhr.readyState)
		console.log("xhr.status = " + xhr.status)
		if(xhr.readyState == 4 && xhr.status == 200) {
			console.log('ajax fonctionne')
			var response = JSON.parse(xhr.responseText);
			console.log(response)
			console.log("response._id = " + response._id)
			console.log(xhr.responseText);

			// elmLigne.style.backgroundColor = "#0f0"
		}
	}

 </script>